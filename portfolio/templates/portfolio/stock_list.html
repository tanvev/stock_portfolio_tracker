<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Stock Portfolio</title>


    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 50px;
        }
        .table thead {
            background-color: #0d6efd;
            color: white;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="header">üìà My Stock Portfolio</h1>

    <!-- Summary -->
    <div class="card shadow mb-4 text-center">
        <div class="card-header bg-dark text-white">üìä Portfolio Summary</div>
        <div class="row p-3">
            <div class="col"><strong>üí∞ Invested:</strong> ‚Çπ{{ total_invested }}</div>
            <div class="col"><strong>üì¶ Quantity:</strong> {{ total_quantity }}</div>
            <div class="col"><strong>üíπ Current Value:</strong> ‚Çπ{{ total_current_value }}</div>
            <div class="col"><strong>üìà Net Gain/Loss:</strong>
                <span class="{% if net_gain_loss >= 0 %}text-success{% else %}text-danger{% endif %}">
                    ‚Çπ{{ net_gain_loss }}
                </span>
            </div>
        </div>
    </div>

    <!-- Pie Chart -->


    <!-- Search and Add -->
    <div class="d-flex justify-content-between mb-3">
        <a href="{% url 'add_stock' %}" class="btn btn-primary">‚ûï Add Stock</a>
        <form method="GET" class="d-flex">
        <input type="text" name="q" class="form-control me-2" placeholder="Search..." value="{{ request.GET.q }}">
        <button type="submit" class="btn btn-outline-primary">Search</button>
        </form>

    </div>

    <!-- Table -->
    <table class="table table-bordered table-hover text-center">
        <thead>
        <tr>
            <th>Name</th>
            <th>Symbol</th>
            <th>Quantity</th>
            <th>Purchase Price</th>
            <th>Total Spent</th>
            <th>Purchase Date</th>
            <th>Current Price</th>
            <th>Current Value</th>
            <th>Gain/Loss</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for stock in stocks %}
            <tr style="background-color: {% if stock.gain_loss > 0 %}#d4edda{% elif stock.gain_loss < 0 %}#f8d7da{% else %}#fff3cd{% endif %};">
                <td>{{ stock.name }}</td>
                <td>{{ stock.symbol }}</td>
                <td>{{ stock.quantity }}</td>
                <td>‚Çπ{{ stock.purchase_price }}</td>
                <td>‚Çπ{{ stock.total_amount_invested }}</td>
                <td>{{ stock.purchase_date }}</td>
                <td>‚Çπ{{ stock.current_price }}</td>
                <td>‚Çπ{{ stock.total_current_value }}</td>
                <td>
                    <span style="color: {% if stock.gain_loss >= 0 %}green{% else %}red{% endif %};">
                        ‚Çπ{{ stock.gain_loss }}
                    </span>
                </td>
                <td>
                    <a href="{% url 'edit_stock' stock.symbol %}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
                    <a href="{% url 'delete_stock' stock.symbol %}" class="btn btn-sm btn-danger">üóëÔ∏è</a>
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="11">No stocks found.</td></tr>
        {% endfor %}
        </tbody>
    </table>

     <div class="card shadow mb-4 mt-4">
        <div class="card-header bg-primary text-white text-center">üìä Stock Value Distribution</div>
        <div class="card-body">
            <div class="d-flex justify-content-center">
    <div style="width: 300px;">
        <canvas id="portfolioPieChart"></canvas>
    </div>
</div>


        </div>
    </div>

    <a href="{% url 'export_csv' %}" class="btn btn-outline-info">üì§ Export CSV</a>
</div>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Pie Chart Script -->
<script>
    const pieLabels = {{ labels|safe }};
    const pieValues = {{ values|safe }};

    const ctx = document.getElementById('portfolioPieChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: pieLabels,
            datasets: [{
                label: 'Stock Quantity',
                data: pieValues,
                backgroundColor: [
                    '#0d6efd', '#6f42c1', '#198754', '#dc3545', '#fd7e14',
                    '#20c997', '#0dcaf0', '#ffc107', '#d63384', '#6c757d'
                ],
                borderColor: '#fff',
                borderWidth: 1
            }],
        },
        options: {
            responsive: true,

            plugins: {
                legend: {
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Stock Value Distribution'
                }
            }
        }
    });
</script>

</body>
</html>